{// 引入标签库 }
<tagLib name="html" />
{// 加载头部公共文件 }
<include file="Public:header" />
<!-- 菜单区域  -->
<script src="__PUBLIC__/Js/AjaxCls.js" type="text/javascript" ></script>
<script language="javascript">
function alertContents()
{
  if(Http_Request.readyState==4)
  {
     if(Http_Request.status==200)
     {
        XMLDocument=Http_Request.responseText;
		if(XMLDocument!="None")
        {
		   Fillset(XMLDocument);
	    }
	 }
     else
     {
        XMLDocument=null;
     }
  }
	  else
  {
     XMLDocument=null;
  }
}
function Fillset(str)
{
  var strarr=str.split('|');
  document.getElementById("area").options.length=0;
  //form1.selCity.options.length=0;
  for(var i=0;i<strarr.length;i++)
  {
	  var cate=strarr[i].split(',');
      document.getElementById("area").options.add(new Option(cate[0],cate[1]));
  }
}
function setcate(bid)
{
  oAjax.sendUrl=APP+"/Admin/Area/ajaxarea/id/"+bid;
  oAjax.getRequest();
  oAjax.getXMLResponse();
}

function setdate(id){
	if(id=="")
	{
	  document.getElementById("s_time1").value="";
	  document.getElementById("s_time2").value="";
	}else{
	  var now = new Date();
	  var n=now.getDay();
	  if(id=="11"){  //明日
		  t1=now.getTime()+24*60*60*1000;
		  t2=now.getTime()+24*60*60*1000;
		  var tdate=new Date();
		  tdate.setTime(t1);
	      var y=tdate.getFullYear();
	      var m=tdate.getMonth()+1;
	      var d=tdate.getDate();
		  var ldate=new Date();
		  ldate.setTime(t2);
		  var ly=ldate.getFullYear();
		  var lm=ldate.getMonth()+1;
		  var ld=ldate.getDate();
	  }else if(id=="22"){  //3日内
		  t1=now.getTime()+24*60*60*1000;
		  t2=t1+24*60*60*1000*3;
		  var tdate=new Date();
		  tdate.setTime(t1);
	      var y=tdate.getFullYear();
	      var m=tdate.getMonth()+1;
	      var d=tdate.getDate();
		  var ldate=new Date();
		  ldate.setTime(t2);
		  var ly=ldate.getFullYear();
		  var lm=ldate.getMonth()+1;
		  var ld=ldate.getDate();
	  }else if(id=="33"){  //5日内
		  t1=now.getTime()+24*60*60*1000;
		  t2=t1+24*60*60*1000*5;
		  var tdate=new Date();
		  tdate.setTime(t1);
	      var y=tdate.getFullYear();
	      var m=tdate.getMonth()+1;
	      var d=tdate.getDate();
		  var ldate=new Date();
		  ldate.setTime(t2);
		  var ly=ldate.getFullYear();
		  var lm=ldate.getMonth()+1;
		  var ld=ldate.getDate();
	  }else if(id=="44"){  //下周
	  	  var ldate=new Date(now-(now.getDay()-8)*86400000);
		  var tdate=new Date((ldate/1000+6*86400)*1000);
		  var y=ldate.getFullYear();
	      var m=ldate.getMonth()+1;
	      var d=ldate.getDate();
		  var ly=tdate.getFullYear();
		  var lm=tdate.getMonth()+1;
		  var ld=tdate.getDate();
	  }else if(id=="66"){  //下月
	  	  var ldate=new Date(now.getYear(),now.getMonth()+1,1);
		  var MonthNextFirstDay=new Date(now.getYear(),now.getMonth()+2,1);
		  var tdate=new Date(MonthNextFirstDay-86400000);
	      var y=ldate.getFullYear();
	      var m=ldate.getMonth()+1;
	      var d=ldate.getDate();
		  var ly=tdate.getFullYear();
		  var lm=tdate.getMonth()+1;
		  var ld=tdate.getDate();
	  }else{
		  var ldate2=new Date();
		  t1=now.getTime()-24*60*60*1000;
		  ldate2.setTime(t1);
		  var y=ldate2.getFullYear();
		  var m=ldate2.getMonth()+1;
		  var d=ldate2.getDate();
		  var ldate=new Date();
		  t2=t1-24*60*60*1000*id;
		  ldate.setTime(t2);
		  var ly=ldate.getFullYear();
		  var lm=ldate.getMonth()+1;
		  var ld=ldate.getDate();
	  }
	document.getElementById("s_time2").value=ly+"-"+lm+"-"+ld;
	document.getElementById("s_time1").value=y+"-"+m+"-"+d;
	}
}
function setdate2(id){
	if(id=="")
	{
	  document.getElementById("c_time1").value="";
	  document.getElementById("c_time2").value="";
	}else{
	  var now = new Date();
	  var n=now.getDay();
	  if(id=="11"){  //明日
		  t1=now.getTime()+24*60*60*1000;
		  t2=now.getTime()+24*60*60*1000;
		  var tdate=new Date();
		  tdate.setTime(t1);
	      var y=tdate.getFullYear();
	      var m=tdate.getMonth()+1;
	      var d=tdate.getDate();
		  var ldate=new Date();
		  ldate.setTime(t2);
		  var ly=ldate.getFullYear();
		  var lm=ldate.getMonth()+1;
		  var ld=ldate.getDate();
	  }else if(id=="22"){  //3日内
		  t1=now.getTime()+24*60*60*1000;
		  t2=t1+24*60*60*1000*3;
		  var tdate=new Date();
		  tdate.setTime(t1);
	      var y=tdate.getFullYear();
	      var m=tdate.getMonth()+1;
	      var d=tdate.getDate();
		  var ldate=new Date();
		  ldate.setTime(t2);
		  var ly=ldate.getFullYear();
		  var lm=ldate.getMonth()+1;
		  var ld=ldate.getDate();
	  }else if(id=="33"){  //5日内
		  t1=now.getTime()+24*60*60*1000;
		  t2=t1+24*60*60*1000*5;
		  var tdate=new Date();
		  tdate.setTime(t1);
	      var y=tdate.getFullYear();
	      var m=tdate.getMonth()+1;
	      var d=tdate.getDate();
		  var ldate=new Date();
		  ldate.setTime(t2);
		  var ly=ldate.getFullYear();
		  var lm=ldate.getMonth()+1;
		  var ld=ldate.getDate();
	  }else if(id=="44"){  //下周
	  	  var ldate=new Date(now-(now.getDay()-8)*86400000);
		  var tdate=new Date((ldate/1000+6*86400)*1000);
		  var y=ldate.getFullYear();
	      var m=ldate.getMonth()+1;
	      var d=ldate.getDate();
		  var ly=tdate.getFullYear();
		  var lm=tdate.getMonth()+1;
		  var ld=tdate.getDate();
	  }else if(id=="66"){  //下月
	  	  var ldate=new Date(now.getYear(),now.getMonth()+1,1);
		  var MonthNextFirstDay=new Date(now.getYear(),now.getMonth()+2,1);
		  var tdate=new Date(MonthNextFirstDay-86400000);
	      var y=ldate.getFullYear();
	      var m=ldate.getMonth()+1;
	      var d=ldate.getDate();
		  var ly=tdate.getFullYear();
		  var lm=tdate.getMonth()+1;
		  var ld=tdate.getDate();
	  }
	document.getElementById("c_time2").value=ly+"-"+lm+"-"+ld;
	document.getElementById("c_time1").value=y+"-"+m+"-"+d;
	}
}
</script>
<!-- 主页面开始 -->
<div id="main" class="main" >

<!-- 主体内容  -->
<div class="content" >
<div class="title">展位租赁列表</div>
<!--  功能操作区域  -->
<div class="operate" >
<input type="button" name="add" value="新增" class="small hMargin shadow submit" onclick="add();"><input type="button" name="exp" value="导出" class="small hMargin shadow submit" onclick="formsubmit();"><input type="button" name="exp" value="导出明天生效的展位" class="hMargin shadow submit" onclick="tomorrow();">
<form method='post' name="form1" id="form1" action="__URL__">
</div>
<!-- 查询区域 -->
<div id="fRig">
<div id="searchM">
<table width="982" cellpadding="1" cellspacing="0" align="left"><input type="hidden" name="flag" value="1" />
<td width="185">商家ID<input type="text" name="trade_id" title="商家ID" size="10" value="{$trade_id}"></td>
<td width="371">机器放置地点ID<input type="text" name="p_id" title="放置地点ID" size="10" value="{$p_id}"></td>
<td width="150">状态：<select name="status">
  <option <eq name="status" value="1" >selected</eq> value="1">正常</option>
  <option <eq name="status" value="" >selected</eq> value="">不限</option>
  <option <eq name="status" value="0" >selected</eq> value="0">预约</option>
  <option <eq name="status" value="-1" >selected</eq> value="-1">删除或到期</option>
</select></td>
</tr>
<tr>
<td colspan="2">租赁起始时间:<select name="tt" onchange="setdate(this.options[this.selectedIndex].value);">
  <option  value="" selected="selected">全部</option>
  <option <eq name="tt" value="11" >selected</eq> value="11" >明日</option>
  <option <eq name="tt" value="22" >selected</eq> value="22" >3日内</option>
  <option <eq name="tt" value="33" >selected</eq> value="33" >5日内</option>
  <option <eq name="tt" value="44" >selected</eq> value="44" >下周</option>
  <option <eq name="tt" value="66" >selected</eq> value="66" >下月</option>
</select><input type="text" id="s_time1" name="s_time1" size="10" onFocus="ShowCalendar(this)" value="{$s_time1}">~<input type="text" id="s_time2" name="s_time2" size="10" onFocus="ShowCalendar(this)" value="{$s_time2}"></td>
<td colspan="2">租赁到期时间：<select name="ttt" onchange="setdate2(this.options[this.selectedIndex].value);">
  <option  value="" selected="selected">全部</option>
  <option <eq name="tt" value="11" >selected</eq> value="11" >明日</option>
  <option <eq name="tt" value="22" >selected</eq> value="22" >3日内</option>
  <option <eq name="tt" value="33" >selected</eq> value="33" >5日内</option>
  <option <eq name="tt" value="44" >selected</eq> value="44" >下周</option>
  <option <eq name="tt" value="66" >selected</eq> value="66" >下月</option>
</select><input type="text" id="c_time1" name="c_time1" size="10" onFocus="ShowCalendar(this)" value="{$c_time1}">~<input type="text" id="c_time2" name="c_time2" size="10" onFocus="ShowCalendar(this)" value="{$c_time2}">
</td></tr>
<tr><td colspan="4">结果排序：<select name="resultid">
  <option <eq name="resultid" value="p_id" >selected</eq> value="id" >地点ID</option>
  <option <eq name="resultid" value="trade_id" >selected</eq> value="trade_id" >商家</option>
  <option <eq name="resultid" value="start_time" >selected</eq> value="start_time" >开始时间</option>
  <option <eq name="resultid" value="close_time" >selected</eq> value="close_time" >结束时间</option>
  <option <eq name="resultid" value="prints" >selected</eq> value="prints" >打印</option>
</select>
<select name="sortid">
  <option <eq name="sortid" value="desc" >selected</eq> value="desc" >递减</option>
  <option <eq name="sortid" value="asc" >selected</eq> value="asc" >递增</option>
</select><input type="submit" value="查询" class="small hMargin shadow submit" onclick="formsubmit2();"></td></tr>
</table>
</div>
</div></form>
<!-- 功能操作区域结束 -->

<!-- 列表显示区域  -->
<div class="list">
<table id="checkList" cellpadding="0" cellspacing="0" width="100%" class="list">
<tr><td height="5" colspan="12" class="topTd"></td></tr>
<tr class="row" align="center">
<th width="40"><a href="javascript:sortBy('id','{$sort}','index')">编号</a></th>
</th><th width="105"><a href="javascript:sortBy('p_id','{$sort}','index')">打印机位置</a></th>
<th width="70"><a href="javascript:sortBy('bt_position','{$sort}','index')">按钮位置</a></th>
<th width="100"><a href="javascript:sortBy('trade_id','{$sort}','index')">商家</a></th>
<th width="40">打印</th>
<th width="100"><a href="javascript:sortBy('start_time','{$sort}','index')">开始时间</a></th>
<th width="90"><a href="javascript:sortBy('close_time','{$sort}','index')">结束时间</a></th>
<th width="90"><a href="javascript:sortBy('create_time','{$sort}','index')">申请时间</a></th>
<th width="205">备注</th><th width="50"><a href="javascript:sortBy('status','{$sort}','index')">状态</th>
<th width="70">操作</th>
</tr>
<foreach name= "list" item= "vo">
<tr id="row{$vo.id}" class="row" onmouseover="over(event)" onmouseout="out(event)" align="center">
<td>{$vo.id}</td>
<td><a href="__APP__/Admin/Location/showexh/id/{$vo.p_id}" title="" target='_blank'>{$vo.p_id|get_position}</a></td>
<td>{$vo.bt_position}</td>
<td><a href="__APP__/Admin/Trade/edit/id/{$vo.trade_id}" target="_blank">{$vo.trade_id|get_trade}</a></td>
<td>{$vo.prints}</td>
<td>{$vo.start_time|date="Y-m-d",###}</td>
<td>{$vo.close_time|date="Y-m-d",###}</td>
<td>{$vo.create_time|date="Y-m-d",###}</td>
<td><input type="text" id="remark{$vo.id}" name="remark" size="28" value="{$vo.remark}" style="border:#FFF 1px solid;" onchange="aupdate('tenancy','{$vo.id}','remark')"></td>
<td><eq name="vo.status" value="1" >正常</eq>
<eq name="vo.status" value="0" >预订</eq>
<eq name="vo.status" value="-1" >到期</eq>
<eq name="vo.status" value="-2" >撤销</eq></td>
<td><a href="javascript:edit('{$vo.id}')">编辑</a>&nbsp;<eq name="vo.status" value="1" ><a href="javascript:forbidden('{$vo.id}')">禁用</a></eq><eq name="vo.status" value="-1" ><a href="javascript:recycle('{$vo.id}')">恢复</a></eq><eq name="vo.status" value="0" ><a href="javascript:recycle('{$vo.id}')">恢复</a></eq>&nbsp;<a href="javascript:adel('{$vo.id}')">删除</a></td>
</tr>
</foreach>
<tr><td height="5" colspan="12" class="bottomTd"></td></tr>
</table>
</div>
<!--  分页显示区域 -->
<div class="page">{$page}</div>
<!-- 列表显示区域结束 -->
</div>
<!-- 主体内容结束 -->
</div>
<!-- 主页面结束 -->

